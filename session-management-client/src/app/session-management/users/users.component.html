<section id="users">
    <div class="top-border">
        <div class="menubar-details">
            <div class="app-details">
                <span class="first-letter">SV</span>
                <span class="menubar-topic">Session Vault</span>
            </div>
            <div class="user-details" (click)="op.toggle($event)">
                <span class="first-letter">A</span>
                <span class="menubar-topic">Ajith</span>
            </div>
        </div>
    </div>
    <div class="wrapper">
        <div class="background">
            <span class="header">Your sessions</span>
            <!-- <div class="main-content">
                <div class="card-wrapper" *ngFor="let card of cards" [ngStyle]="{
                    'pendingCard': card.name === 'Pending',
                    'approvedCard': card.name === 'Approved',
                    'rejectedCard': card.name === 'Rejected',
                }">
                    <div class="cards">
                        <span class="count">0</span>
                        <span class="name">Total</span>
                    </div>
                </div>
            </div> -->
            <div class="btn-details">
                <div class="search">
                    <p-iconField iconPosition="left">
                        <p-inputIcon styleClass="pi pi-search" />
                        <input (ngModelChange)="search.next($event)" [(ngModel)]="searchText" type="text" pInputText placeholder="Search" />
                    </p-iconField>
                </div>
                <div class="calender-add">
                    <div class="calender">
                        <p-calendar [(ngModel)]="selectDate" placeholder="Choose Date" dateFormat="dd-mm-yy" [iconDisplay]="'input'"
                            [showIcon]="true" inputId="icondisplay" (ngModelChange)="selectedDate()" />
                    </div>
                    <div (click)="openSessionFrom()">
                        <p-button label="Create"></p-button>
                    </div>
                </div>
            </div>
            <div class="table">
                <p-table [value]="sessionDetails" [lazy]="true" [columns]="sessionCols" selectionMode="single"
                    [scrollable]="true" scrollHeight="260px">
                    <ng-template pTemplate="header" let-columns>
                        <tr>
                            <th *ngFor="let col of columns">
                                {{ col.header }}
                            </th>
                            <th>Remove</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-rowData let-rowIndex="rowIndex" let-columns="columns">
                        <tr [ngStyle]="{ 'cursor': 'pointer'}">
                            <td *ngFor="let col of columns" (click)="openEditSideBar(rowData)">
                                <ng-container *ngIf="col.field != 'approvalId' && col.field != 'remove'">
                                    {{ rowData[col.field] }}
                                </ng-container>
                                <ng-container *ngIf="col.field == 'approvalId'">
                                    <span
                                        [ngStyle]="rowData[col.field] == 1 ? {'color': '#1E6AD2'} : rowData[col.field] == 2 ? {'color': '#27AE60'} : {'color': '#EB5757'}">
                                        {{ rowData[col.field] === 1 ? 'Pending' : rowData[col.field] === 2 ? 'Approved'
                                        : 'Rejected' }}
                                    </span>
                                </ng-container>
                            </td>
                            <td>
                                <span class="remove" *ngIf="rowData.approvalId === 1" (click)="confirm($event, rowData)">
                                    {{ rowData.approvalId === 1 ? 'Remove' : '-' }}
                                </span>
                                
                            </td>
                        </tr>
                    </ng-template>
                </p-table>
                <div *ngIf="!sessionDetails.length" class="no-data">
                    No data found.
                </div>
            </div>

            <p-sidebar [(visible)]="sessionOpenFlag" [style]="{width:'30em'}" position="right">
                <ng-template pTemplate="header">
                    <span *ngIf="!sessionEdit" class="sub-header">Create session details</span>
                    <span *ngIf="sessionEdit" class="sub-header">Update session details</span>
                </ng-template>
                <div class="sessionFrom-form" [formGroup]="sessionFrom">
                    <div class="fields">
                        <label class="required label">Topic</label>
                        <input type="text" placeholder="Enter Topic" formControlName="topic" pInputText />
                        <div class="error-message"
                            *ngIf="(form['topic'].dirty || form['topic'].touched) && form['topic'].invalid">
                            <span *ngIf="form['topic'].errors?.['required']">Topic is required</span>
                            <span
                                *ngIf="form['topic'].errors?.['minlength'] && !form['topic'].errors?.['pattern']">Topic
                                must be a minimum of 3 characters</span>
                            <span *ngIf="form['topic'].errors?.['maxlength']"> Topic must be a maximum of 100
                                characters</span>
                            <span *ngIf="form['topic'].errors?.['pattern']">Topic is invalid</span>
                        </div>
                    </div>

                    <div class="fields">
                        <label class="label required">Date</label>
                        <p-calendar [minDate]="currentDate" placeholder="Choose Date" dateFormat="dd-mm-yy"
                            formControlName="date" [iconDisplay]="'input'" [showIcon]="true" />
                        <div class="error-message"
                            *ngIf="(form['date'].dirty || form['date'].touched) && form['date'].invalid">
                            <span *ngIf="form['date'].errors?.['required']">Date is required</span>
                        </div>
                    </div>

                    <div class="fields">
                        <label class="required label">Department</label>
                        <p-dropdown [options]="departmentDetails" placeholder="Choose Department"
                            formControlName="departmentId" optionLabel="name" optionValue="id"></p-dropdown>
                        <div class="error-message"
                            *ngIf="(form['departmentId'].dirty || form['departmentId'].touched) && form['departmentId'].invalid">
                            <span *ngIf="form['departmentId'].errors?.['required']">Department is required</span>
                        </div>
                    </div>

                    <div class="fields">
                        <label class="label">Team Lead</label>
                        <p-dropdown [options]="teamLeadsDetails" placeholder="Choose Team Lead" formControlName="leadId"
                            optionLabel="name" optionValue="id"></p-dropdown>
                    </div>

                    <div class="fields">
                        <label class="required label">Designation</label>
                        <p-dropdown [options]="designationDetails" placeholder="Choose Designation"
                            formControlName="designationId" optionLabel="name" optionValue="id"></p-dropdown>
                        <div class="error-message"
                            *ngIf="(form['designationId'].dirty || form['designationId'].touched) && form['designationId'].invalid">
                            <span *ngIf="form['designationId'].errors?.['required']">Team lead is required</span>
                        </div>
                    </div>

                    <div class="fields">
                        <label class="label required custom">Taking Hrs</label>
                        <p-inputNumber placeholder="Enter Hrs" formControlName="takingHrs"></p-inputNumber>
                        <div class="error-message"
                            *ngIf="(form['takingHrs'].dirty || form['takingHrs'].touched) && form['takingHrs'].invalid">
                            <span *ngIf="form['takingHrs'].errors?.['required']">Taking hrs is required</span>
                        </div>
                    </div>
                </div>
                <ng-template pTemplate="footer">
                    <div class="all-btn">
                        <div class="back-btn">
                            <p-button label="Cancel" (click)="cancel()"></p-button>
                        </div>
                        <div class="sidenav-btn">approvalId
                            <p-button *ngIf="!sessionEdit" label="Create" (click)="saveSessionDetails()"></p-button>
                            <p-button *ngIf="sessionEdit" label="Update" (click)="saveSessionDetails()"></p-button>
                        </div>
                    </div>
                </ng-template>
            </p-sidebar>
            <p-sidebar [(visible)]="editSideBar" position="right" [style]="{width:'30em'}">
                <ng-template pTemplate="header">
                    <span class="emp-id">Edit Session Details</span>
                </ng-template>
                <ng-template pTemplate="content">
                    <div class="details-wrapper">
                        <div class="other-details">
                            <div class="detail-group">
                                <div class="one-detail">
                                    <span class="label">Topic</span>
                                    <span class="value">{{ editSessionDetails.topic }}</span>
                                </div>
                                <div class="one-detail">
                                    <span class="label">Team Lead</span>
                                    <span class="value">{{ editSessionDetails.teamLeadName }}</span>
                                </div>
                            </div>
                            <div class="detail-group">
                                <div class="one-detail">
                                    <span class="label">From Time</span>
                                    <span class="value">{{ editSessionDetails.fromTime }}</span>
                                </div>
                                <div class="one-detail">
                                    <span class="label">To Time</span>
                                    <span class="value">{{ editSessionDetails.toTime }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </ng-template>
                <ng-template pTemplate="footer">
                    <div class="all-btn">
                        <div class="back-btn">
                            <p-button label="Cancel" (click)="cancelEditSideBar()"></p-button>
                        </div>
                        <div class="sidenav-btn" *ngIf="statusFlag">
                            <p-button label="Edit" (click)="editSession(editSessionDetails)"></p-button>
                        </div>
                    </div>
                </ng-template>
            </p-sidebar>
            <p-confirmPopup #confirmPopupRef>
                <ng-template pTemplate="headless" let-message let-test>
                    <div class="border-round p-3">
                        <span>{{ message.message }}</span>
                        <div class="flex align-items-center gap-2 mt-3">
                            <p-button (click)="removeSession()" label="Yes" size="small" />
                            <p-button (click)="reject()" label="No" [outlined]="true" size="small" />
                        </div>
                    </div>
                </ng-template>
            </p-confirmPopup>
        </div>
    </div>
    <p-overlayPanel #op>
        <div class="logout" (click)="logout()">
            <span>Log Out</span>
        </div>
    </p-overlayPanel>
</section>